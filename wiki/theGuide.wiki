#labels Featured
_a step by step guide for successfully building your .mac replacement._

= Introduction =

This document details all steps to take for successfully building your .mac replacement.


= The staircase =

==Step 1==
====Set up your server====

Setup a basic Linux/Unix server; configure hostname and ip-address. Install Perl.
Either install a build environment, or fetch precompiled packages for Apache httpd here (available shortly).
In case you decided to compile your own Apache httpd server, fetch the source code and the (Patches) quota patch (from this site), patch, configure, compile.
Install Apache httpd.
_(*note - basically this could also be done on a Mac (OS 10.4) (not verified yet); Apache http compiles on Leopard, but mod_ssl is broken (http://trac.macports.org/projects/macports/ticket/13182).)_
==Step 2==
====Configure your webserver====

Fetch the code/folders (here) from svn.
All code (/server) assumes, it'll end up in /var/www/dotmac/
This'll guarantee a minimal configuration effort.

A special .conf file was provided (here) in addition to your standard httpd.conf.
This file ((Configuration) dotmac.conf) _must_ be edited.
Especially the ip-address for your ssl host needs to be specified.
In most linux distros it should end up in /etc/httpd/conf.d or /etc/apache2/conf.d

==Step 3==
====Set up you scripts====

mod_perl needs to be installed with your webserver. mod_perl is available as package for most
popular linux distributions.
All folders _except_ ./dotmac/private should be owned by the user/group apache runs as.
(nobody, apache, www-data)
./dotmac/private contains both server certificates and the .htdigest (user/password) database.

As we're moving al perl scripts to perl modules (mod_perl), the only scripts left that need to be
executable (chmod +x) reside in ./dotmac/WebObjects
They _do_ need to be executable!
In the near future, everything is moved to perl modules - so there will be no need for setting
executable permissions on scripts anymore.

You'll find the file 'startup.pl' in .dotmac/perlmodules/
This file also needs editing for reflecting the correct path to perlmodules

The perlmodules have a few dependencies; they're easily installed from CPAN:
{{{
perl -MCPAN -e 'install HTTPD::UserAdmin'
perl -MCPAN -e 'install MD5'
perl -MCPAN -e 'install XML::DOM'
perl -MCPAN -e 'install HTTP::DAV'
}}}

==Step 4==
====Setting up hosts on your client machine(s)====
{{{
www.mac.com
syncmgmt.mac.com
idisk.mac.com
configuration.apple.com
lcs.mac.com
certinfo.mac.com
delta.mac.com
notify.mac.com
publish.mac.com
homepage.mac.com
}}}
should all point to your server. You can either do this by editing /etc/hosts on your client machine(s);
{{{
###.###.###.### www.mac.com syncmgmt.mac.com idisk.mac.com configuration.apple.com lcs.mac.com certinfo.mac.com delta.mac.com notify.mac.com publish.mac.com homepage.mac.com
}}}
or by setting up your own DNS server.
_(*note - several users have reported that Leopard doesn't honour /etc/hosts like this all the time, a (non verified) solution seems to be adding the hosts again with a trailing dot)_
{{{
###.###.###.### www.mac.com. syncmgmt.mac.com. idisk.mac.com. configuration.apple.com. lcs.mac.com. certinfo.mac.com. delta.mac.com. notify.mac.com. publish.mac.com. homepage.mac.com.
}}}
==Step 5==
====Create your first user(s)====

at your prompt, for your first iDisk user; issue:
{{{
htdigest -c /var/www/dotmac/private/iDiskUsers idisk.mac.com username
}}}
(you'll be prompted for password twice)
for additional users, issue:
{{{
htdigest /var/www/dotmac/private/iDiskUsers idisk.mac.com username
}}}
A skeleton is provided for new users; create /var/www/dotmac/username, and copy everything in /var/www/dotmac/skel/ to /var/www/idisk/username/
In every userfolder (/var/www/idisk/username) create a .htaccess file with 2 lines:
`Dav On
DAVSATMaxAreaSize 1024000`
(edit DAVSATMaxAreaSize according to your needs - it calculates in KB)

for testing purposes, a test user has been provided: l/p testuser/dotmac

_(*note - in the near future we hope to provide with a web interface, for creating users (user-folders, quota, and passwords) - a preliminary web-page is available at /idiskAdmin)_

==Step 6==
====Check(s)====

By now you should be able to ï£¿k (from the finder on a client machine) to http://idisk.mac.com/username
(if not, try looking at your apache error logs, and adapt your configuration)

_this is to be repeated for all (new) clients:_
Point your (safari) browser to https://idisk.mac.com/username
You will be challenged with an untrusted certificate - actually this is the certificate you _do_ want to trust.
Examine the certificate, and drag the icon of the certificate to your Desktop (or any folder of your choice).
Open /Applications/Utilities/Keychain Access, and (if necessary, tick the button 'Show Keychains' at bottom-left)
By now you should see a menu 'Keychains' in the top-left. Tick the 'login' entry. Drag the certificate (from whereever you put it when dragging it from your browser) in the pane where all other certificates reside. Locate it (in the pane) and double-click it. Change the trust settings to 'always trust'.
After Logout/Login - check (pointing your browser https://idisk.mac.com/username) if the certificate is trusted.
If so... you're done!

Enjoy the magic, when choosing your .mac preferences pane from your system preferences !


==Looking over the edge==
==== Current status ====

10.4 "Tiger"
  * .Mac prefpane
  * iSync support
  * iDisk
  * iDisk sync
  * Backup

10.5 "Leopard"
  * .Mac prefpane
  * iSync
  * iDisk
  * Backup

_(*note - currently there's no interoperability between 10.4 and 10.5 sync clients)_

==== Operating Systems Verified ====

Users reported the following Operating Systems Working:
  * CentOS 5
  * Fedora Core 5, 6
  * Debian 'etch'
  * Ubuntu 'Edgy Eft' (6.x), 'Feisty Fawn' (7.x)
  * Solaris 10

please continue reporting!
  