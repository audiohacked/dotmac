// ==================================================================================
// Copyright 2007, Apple, Inc.  All rights reserved.
//
// IMPORTANT NOTE:  This file is licensed only for use in providing the .Mac service,
// or any part thereof, and is subject to the .Mac Terms and Conditions.  You may not
// port this file to another platform without Apple's written consent.
// ==================================================================================

Mac=SproutCore;Mac.PanelView.prototype.wrapperView=SC.ContainerView.extend({emptyElement:'<div class="panel"></div>',visibleAnimation:{visible:'top: 0px',hidden:'top: -500px',duration:500,onComplete:function(wrapperView){if(!wrapperView.get('isVisible')){Mac.panels.hidePanelDidComplete(wrapperView);}}}});Mac.View.windowWidth=function(){w=window;return w.innerWidth||(w.document.documentElement.clientWidth||w.document.body.clientWidth);};Mac.View.windowHeight=function(){w=window;return w.innerHeight||(w.document.documentElement.clientHeight||w.document.body.clientHeight);};var delim="-with-";var nonEmptyPowerSetOf=function(start){var powerSet=[];for(var i=start.length-1;i>=0;i--){var e=start[i];for(var j=powerSet.length-1;j>=0;j--){powerSet[powerSet.length]=[e].concat(powerSet[j]);}
powerSet[powerSet.length]=[e];}
for(var i=0;i<powerSet.length;i++)
powerSet[i].sort();return powerSet.sort(function(a,b){return a.length-b.length;});}
getClassNames=function(el){if(!(el=$(el)))return null;var existing=el.className;if(existing==null||existing==undefined)existing="";existing=existing.split(" ");if(existing.length==0||(existing[0]==""&&existing.length==1))
existing=[];for(var i=0;i<existing.length;i++)if(existing[i].indexOf(delim)!=-1)existing.splice(i,existing.length-i);return existing;};Element.ClassNames.prototype.add=function(className){if(SC.isIE6()&&className=="disabled"){var idd=this.element.id;if(idd!=null&&idd!="")className+="WithID"+idd;}
if(this.include(className))return;var existing=$A(this);for(var i=0;i<existing.length;i++)if(existing[i].indexOf(delim)!=-1)existing.splice(i,existing.length-i);existing[existing.length]=className;var power=nonEmptyPowerSetOf(existing);for(var i=0;i<power.length;i++)
power[i]=power[i].join(delim);this.set(power.join(" "));};Element.ClassNames.prototype.remove=function(className){if(SC.isIE6()&&className=="disabled"){var idd=this.element.id;if(idd!=null&&idd!="")className+="WithID"+idd;}
var existing=$A(this);for(var i=0;i<existing.length;i++)if(existing[i].indexOf(delim)!=-1)existing.splice(i,existing.length-i);existing=existing.without(className)
var power=nonEmptyPowerSetOf(existing);for(var i=0;i<power.length;i++)
power[i]=power[i].join(delim);this.set(power.join(" "));};function fixClassName(el){if(!(el=$(el))){return;}
if(el.classNameFixed==true)return el.className;el.classNameFixed=true;var existing=$A(el.classNames());var power=nonEmptyPowerSetOf(existing);for(var i=0;i<power.length;i++)
power[i]=power[i].join(delim);el.classNames().set(power.join(" "));return el.className;};function fixDOMSubtreeClassNames(node){if(node.className&&node.className!=""&&node.className.indexOf(" ")!=-1)fixClassName(node);if(node.childNodes)for(var i=0;i<node.childNodes.length;i++)fixDOMSubtreeClassNames(node.childNodes[i]);}
fixDOMSubtreeClassNames($tag("body"));require('core');Mac.Adaptor=Mac.Object.extend({tokens:{},base:'',namespaces:['Mac'],requests:{},currentURL:'',_requestHistory:{},requestQueue:[],defaultOptions:{method:'get',useSpinner:false,asynchronous:true},showSpinner:false,emptyRecordSet:false,_useEtag:false,start:0,end:0,_prepareRequest:function(parameters){var params,tokens;if(parameters){params=$H(parameters);}
if(this.tokens){tokens=$H(this.tokens);}
if(parameters&&this.tokens){params=params.merge(tokens);}
else if(tokens){params=tokens;}
if(params){return params.toQueryString();}},_updateRecords:function(result){if(result.records&&result.records.length>0){this.set('emptyRecordSet',false);SC.Benchmark.start('dataProcessTime');Mac.Store.updateRecords(this.mapRecordsToNamespaces(result.records),this,Mac.Record,true);SC.Benchmark.end('dataProcessTime');}
else{this.set('emptyRecordSet',true);}},_insertHTMLContent:function(result){var newElement,currentElement;if(result.htmlcontent){for(var i in result.htmlcontent){currentElement=Mac.View.viewFor($(i));currentElement.set('innerHTML',result.htmlcontent[i]);}}
if(Event.compactCache){Event.compactCache();}},_updateTokens:function(result){for(var token in result.tokens){Mac.Application.tokens.set(token,result.tokens[token]);}},request:function(requestName,parameters,onSuccess,onError,onFailure){var url;var options=Object.clone(this.defaultOptions);if(typeof this.requests[requestName].action=='function')
url=this.base+this.requests[requestName].action();else
url=this.base+this.requests[requestName].action;if(this.requests[requestName].asynchronous)
options.asynchronous=this.requests[requestName].asynchronous;if(this.requests[requestName].method)
options.method=this.requests[requestName].method;if(this.requests[requestName].useEtag!==null&&this.requests[requestName].useEtag!==undefined)
this._useEtag=this.requests[requestName].useEtag;else
this._useEtag=true;var params=null;if($type(parameters)=="string"){params=this._prepareRequest();if(options.method=='post')
options.postBody=parameters;else if(params||parameters)
params=[params,parameters].compact().join('&');}else{params=this._prepareRequest(parameters);if(options.method=='post'){options.postBody=params;params=null;}}
if(params)url=url+'?'+params;delete options.parameters;this.set('currentURL',url);options.requestHeaders={};var view=Gallery.workspace.get('nowShowing');if(!view)view='detail';else if(view=='imovie')view='movie';else if(view=='carouseljs')view='carousel';else if(view=='slideshow')view='slide';options.requestHeaders={'X-Gallery-View':view};if(this._requestHistory[url]&&this._useEtag){options.requestHeaders=Object.extend(options.requestHeaders,{'If-None-Match':this._requestHistory[url]});}
if(this.requests[requestName].useSpinner)
this.set('showSpinner',true);this.requestQueue[url]={onSuccess:onSuccess||this.requests[requestName].onSuccess||Prototype.emptyFunction,onError:onError||this.requests[requestName].onError||Prototype.emptyFunction,onFailure:onFailure||this.requests[requestName].onFailure||Prototype.emptyFunction};var that=this;that.set('start',new Date().getTime());Mac.Server.request(url,options,that);},handleResponse:function(response,result,url){var etag=response.getResponseHeader('Etag');if(etag&&this._useEtag){var previousETag=this._requestHistory[url];this._requestHistory[url]=etag;if(etag==previousETag){return;}}
this._useEtag=true;this._updateRecords(result);this._insertHTMLContent(result);this._updateTokens(result);switch(result.status)
{case-1:case 0:this.requestQueue[url].onError(response,result);break;case 1:case 3:case 4:this.requestQueue[url].onSuccess(response,result);break;}},handleXMLResponse:function(response,url){this.requestQueue[url].onSuccess(response,result);},handleTextResponse:function(response,url){this.requestQueue[url].onSuccess(response,result);},mapRecordsToNamespaces:function(records){var type,ns,adaptor=this;records.each(function(record,index){if(record.type){type=record.type
ns=adaptor.namespaces.detect(function(namespace){if(eval(namespace+'.'+type)){return true;}else{return false;}});if(ns){record.recordType=eval(ns+'.'+type);}}});return records;}});Mac.ServerJSVersion="$Revision: 1.3 $";require('core');Mac.Server=Mac.Object.create({_pollingTimer:null,_observers:{html:{},tokens:{}},_lastRequest:null,_requestName:null,adaptor:null,_clearPollingTimer:function(){if(this._pollingTimer){clearInterval(pollingTimer);this._pollingTimer=null;}},_threadResponse:function(originalResponse,successFunc){var result=this._parseJsonResponse(originalResponse,successFunc);if(result){successFunc(result);}},_reportError:function(errorMessage){this._clearPollingTimer();if(!errorMessage)errorMessage="Request failed.";},_evaluateXMLResponse:function(originalResponse,url){this.adaptor.handleXMLResponse(originalResponse,url);},_evaluateTextResponse:function(originalResponse,url){this.adaptor.handleTextResponse(originalResponse,url)},_parseJsonResponse:function(originalResponse,url){var result;var errorMessage;var statusMessage;try{var txt=originalResponse.responseText;if(txt.substr(0,2)=="/*"){txt=txt.substring(2,txt.length-2);}
var start=new Date().getTime();var result=eval("("+txt+")");var end=new Date().getTime();switch(result.status){case-1:case 0:case 1:case 3:case 4:this._clearPollingTimer();this.adaptor.handleResponse(originalResponse,result,url);break;case 2:this._checkThreadedResponse(result,successFunc);break;default:this._clearPollingTimer();}}
catch(e){this._clearPollingTimer();}
result=null;return result;},_checkThreadedResponse:function(result,successFunc){var url=urlBase()+'wa/ScriptAction/checkThreadStatus';var postBody='threadName='+encodeURIComponent(result.threadName);var timeInterval=result.pollInterval?result.pollInterval*1000:3000;this._clearPollingTimer();that=this;pollingTimer=setTimeout(function(){new Ajax.Request(url,{method:'post',postBody:postBody,onFailure:that._reportError,onSuccess:function(originalResponse){that._threadResponse(originalResponse,successFunc);}});},timeInterval);},request:function(url,options,adaptor){this.adaptor=adaptor;options.onFailure=function(url,t){SC.Benchmark.end('dataLoadTime');that.adaptor.set('end',new Date().getTime());that.adaptor.set('start',0);that.adaptor.set('end',0);that.adaptor.requestQueue[url].onFailure(t);}.bind(this,url);var that=this;options.onComplete=function(url,t){that.adaptor.set('showSpinner',false);}.bind(this,url);options.onSuccess=function(url,t){if(that._lastRequest==null){setTimeout(arguments.callee.bind(this,t),1);return;}
SC.Benchmark.end('dataLoadTime');var result,contentType=that._lastRequest.getHeader('Content-Type');if(contentType===null||contentType===undefined){that.adaptor.requestQueue[url].onFailure(t);}
that.adaptor.set('end',new Date().getTime());that.adaptor.set('start',0);that.adaptor.set('end',0);if(contentType){contentType=contentType.split(';')[0];switch(contentType){case'application/x-javascript':case'text/javascript':case'text/json':case'application/json':result=that._parseJsonResponse(t,url);break;case'text/xml':case'application/xml':case'application/rss+xml':case'application/atom+xml':result=that._evaluateXMLResponse(t,url);break;default:result=that._parseJsonResponse(t,url);}}
else{result=that._evaluateTextResponse(t,url);}
that._lastRequest==null;}.bind(this,url);SC.Benchmark.start('dataLoadTime');this._lastRequest=new Ajax.Request(url,options);}});require('core');Mac.Strings={'--@@MULT@@--':"Multiple Selection",'--@@EMPTY@@--':"No Selection",'--@@NOTAPP@@--':'','Controller.NoSelection':'None Selected','Controller.MultipleSelection':'Multiple Selected'};Mac.FlashView=Mac.View.extend({resourceURL:null,width:null,height:null,version:"0",loadParameters:{},loadVariables:{},loadAttributes:{},quality:'high',locked:false,hasValidVersion:function(){var parts=this.get('version').split('.');var vers=Mac.FlashView.playerVersion();if(vers==null)return false;for(var loc=0;loc<parts.length;loc++){var req=parts[loc];var ver=vers[loc];if(ver>req)return true;if(ver<req)return false;}
return true;}.property(),movie:function(){return $(this.get('flashId'));}.property(),flashId:null,flashProperties:[],flashNotAvailable:function(){console.log('required version of flash is not available.');},flashPropertyDidChange:function(key,value){this.set(key,value);},_flashPropertyObserver:function(target,key,value){var movie=this.get('movie');if(movie&&this.flashProperties&&this.flashProperties.include(key)){movie.externalPropertyDidChange(key,value);}}.observes('*'),_lockedObserver:function(){if(this.didChangeFor('locked','locked'))this.render();}.observes('locked'),render:function(){if(typeof(Gallery)!="undefined"&&!Gallery.fullscreen&&this.get('locked'))return;if(this.didChangeFor('render','resourceURL','version','height','width','quality','loadVariables','loadParameters','loadAttributes')){if(this.get('hasValidVersion')==false)return this.flashNotAvailable();var swfNode="";var variables=this.get('loadVariables')||{};var params=this.get('loadParameters')||{};var attrs=this.get('loadAttributes')||{};var url=this.get('resourceURL');attrs.id=this.get('flashId');params.quality=this.get('quality')||'high';var height=this.get('height');if(height)attrs.height=height;var width=this.get('width');if(width)attrs.width=width;if(!attrs.wmode)attrs.wmode="window";if(!attrs.scale)attrs.scale="noborder";if(!attrs.menu)attrs.menu="false";variables.callMethod='Mac.FlashView._flashCallMethod';variables.ownerView=this._guid;var attrPairs=[];for(var key in attrs){attrPairs.push('%@="%@"'.format(key,attrs[key]));}
var varPairs=[];for(var key in variables){varPairs.push("%@=%@".format(key,variables[key]));}
var loc=this.flashProperties.length;while(--loc>=0){var key=this.flashProperties[loc];var val=this.get(key);if(val)varPairs.push('%@=%@'.format(key,val));}
var varstr=varPairs.join('&');if(navigator.plugins&&navigator.mimeTypes&&navigator.mimeTypes.length){for(var key in params){attrPairs.push('%@="%@"'.format(key,params[key]));}
if(varstr.length>0)attrPairs.push('flashvars="%@"'.format(varstr));swfNode='<embed type="application/x-shockwave-flash" src="%@" %@ />'.format(url,attrPairs.join(' '));}else{var paramPairs=[];paramPairs.push('<param name="movie" value="%@" />'.format(url));for(var key in params){paramPairs.push('<param name="%@" value="%@" />'.format(key,params[key]));}
if(varstr.length>0){paramPairs.push('<param name="flashvars" value="%@" />'.format(varstr));}
swfNode='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" %@ >%@</object>'.format(attrPairs.join(' '),paramPairs.join("\n"));}
this.innerHTML=swfNode;}}.observes('*'),init:function(){arguments.callee.base.call(this);_flashViews[this._guid]=this;this.flashId="flashview%@".format(this._guid);this.registerDependentKey('hasValidVersion','version');this.render();}});Mac.FlashView.mixin({playerVersion:function(){var parts=[0,0,0];var found=false;if(navigator.plugins&&navigator.mimeTypes.length){var x=navigator.plugins["Shockwave Flash"];if(x&&x.description){found=true;parts=x.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s+r|\s+b[0-9]+)/,".").split('.');}}else if(navigator.userAgent&&navigator.userAgent.indexOf("Windows CE")>=0){var axo=1;var counter=3;while(axo){try{counter++;axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+counter);found=true;parts=[counter,0,0];}catch(e){axo=null;}}}else{try{var axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7");}catch(e){try{var axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");parts=[6,0,21];found=true;axo.AllowScriptAccess="always";}catch(e){if(parts[0]==6)found=true;}
if(!found){try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");}catch(e){}}}
if((!found)&&(axo!=null)){found=true;parts=axo.GetVariable("$version").split(" ")[1].split(",");}}
if(found){return parts.map(function(p){return parseInt(p,10);});}else return null;},_flashCallMethod:function(guid,methodName){console.log('_flashCallMethod(%@)'.format($A(arguments)));args=$A(arguments);args.shift();args.shift();var view=_flashViews[guid];if(view){var f=view[methodName];f.apply(view,args);}}});_flashViews={};require('core');Mac.View.List=Mac.View.extend({generateList:function(){var html=[];var view=this;var content=Array(this.get('contentObject')).flatten();console.log('content = '+content);content.each(function(c){var itemKey=c.get(view.primaryKey);var labelText=c.get(view.labelKey);html.push('<a href="#" onclick="AB.controllers.contacts.select(\''+itemKey+'\');" >'+labelText+'</a>');});this.innerHTML=html.join('<br>');},propertyObserver:function(observing,target,key){if(observing=='content'){this.set('contentObject',target.get(key));this.generateList();}},observers:['content'],content:null,primaryKey:'firstName',labelKey:'fullName'});Mac.CalendarGridDay=Mac.View.extend({day:null,date:null,hasEvents:false,isOffMonth:null,thisId:null,outlets:["dateDisplay"],dateDisplay:Mac.LabelView.outletFor(".dateDisplay?"),didClick:function()
{console.log("Action!");}});Mac.MonthCalendarView=Mac.View.extend({showingDate:null,todayDate:null,selectedDate:null,selectedId:null,dayStart:0,locMonths:["January","February","March","April","May","June","July","August","September","October","November","December"],locDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"],outlets:["calendarGridLabel","calendarGridDays","day1Label","day2Label","day3Label","day4Label","day5Label","day6Label","day7Label"],monthGridHeading:function()
{var showingDate=new Date(this.get("showingDate"));if(showingDate)
{var thisMonth=showingDate.getMonth();var thisYear=showingDate.getFullYear();return this.locMonths[thisMonth]+" "+thisYear;}}.property(),calendarStart:function()
{var showingDate=new Date(this.get("showingDate"));var dayStart=this.get("dayStart");if(showingDate)
{var thisMonth=showingDate.getMonth();var thisYear=showingDate.getFullYear();var monthStart=new Date(thisYear,thisMonth,1,0,0,0,0);var offset=dayStart-monthStart.getDay();if(offset>0)
{offset=dayStart-monthStart.getDay()-7;}
return new Date(showingDate.getFullYear(),showingDate.getMonth(),offset+1,0,0,0,0);}}.property(),init:function()
{arguments.callee.base.call(this);this.registerDependentKey('monthGridHeading','showingDate');this.registerDependentKey('calendarStart','showingDate');this.calendarHeadings();},day1Label:Mac.LabelView.extend({}).outletFor('.day1Label?'),day2Label:Mac.LabelView.extend({}).outletFor('.day2Label?'),day3Label:Mac.LabelView.extend({}).outletFor('.day3Label?'),day4Label:Mac.LabelView.extend({}).outletFor('.day4Label?'),day5Label:Mac.LabelView.extend({}).outletFor('.day5Label?'),day6Label:Mac.LabelView.extend({}).outletFor('.day6Label?'),day7Label:Mac.LabelView.extend({}).outletFor('.day7Label?'),calendarHeadings:function()
{var dayStart=this.get("dayStart");this.day1Label.set("content",this.locDays[(0+dayStart)%7]);this.day2Label.set("content",this.locDays[(1+dayStart)%7]);this.day3Label.set("content",this.locDays[(2+dayStart)%7]);this.day4Label.set("content",this.locDays[(3+dayStart)%7]);this.day5Label.set("content",this.locDays[(4+dayStart)%7]);this.day6Label.set("content",this.locDays[(5+dayStart)%7]);this.day7Label.set("content",this.locDays[(6+dayStart)%7]);},renderObserver:function()
{if(!this.didChangeFor('render','showingDate','todayDate','calendarStart')){return;}
var showingDate=this.get('showingDate');var todayDate=this.get('todayDate');var selectedDate=this.get('selectedDate');var selectedDateDay=(selectedDate)?new Date(selectedDate).getDate():0;if(showingDate===null||todayDate===null){return;}
var thisMonth=new Date(showingDate).getMonth();var renderDay=this.get("calendarStart");for(var i=0;i<6;i++)
{var allOffMonth=true;var rowCount=0;for(var j=0;j<7;j++)
{var myDay=this.calendarGridDays[7*i+j];if(myDay.id)
{if(thisMonth==renderDay.getMonth())
{allOffMonth=false;}
myDay.set("isVisible",true);var displayDay=renderDay.getDate().toString();Element.setClassName(myDay,"selectedDate",selectedDateDay==renderDay.getDate()&&thisMonth==renderDay.getMonth()&&selectedDate!=todayDate);Element.setClassName(myDay,"todayDate",renderDay.getTime()==todayDate);Element.setClassName(myDay.dateDisplay,"offMonth",thisMonth!=renderDay.getMonth());myDay.set("date",renderDay.getTime());myDay.dateDisplay.set("content",displayDay);if(this.get("hasEvents"))
{myDay.events.set("content",Thunderbolt.VEvent.findAll({'localDate':renderDay.getTime()}));}
renderDay.setDate(renderDay.getDate()+1);}}
if(allOffMonth)
{for(var k=0;k<7;k++)
{var myDay=this.calendarGridDays[7*i+k];myDay.set("isVisible",false);}}
else
{rowCount++;}}
switch(rowCount)
{case 4:Element.setClassName(this,"4Row");Element.removeClassName(this,"5Row");Element.removeClassName(this,"6Row");break;case 5:Element.setClassName(this,"5Row");Element.removeClassName(this,"4Row");Element.removeClassName(this,"6Row");break;case 6:Element.setClassName(this,"5Row");Element.removeClassName(this,"4Row");Element.removeClassName(this,"5Row");break;}}.observes('showingDate','todayDate','calendarStart'),selectedDateObserver:function()
{if(!this.didChangeFor('sDate','selectedDate')){return;}
var renderDay=this.get("calendarStart");var showingDate=this.get("showingDate");var selectedDate=this.get("selectedDate");var selectedDateDay=(selectedDate)?new Date(selectedDate).getDate():0;var todayDate=this.get("todayDate");var thisMonth=new Date(selectedDate).getMonth();for(var i=0;i<42;i++)
{var myDay=this.calendarGridDays[i];Element.setClassName(myDay,"selectedDate",selectedDateDay==renderDay.getDate()&&thisMonth==renderDay.getMonth()&&selectedDate!=todayDate);renderDay.setDate(renderDay.getDate()+1);}}.observes('selectedDate'),calendarGridLabel:Mac.LabelView.extend({contentBinding:"*owner.monthGridHeading"}).outletFor('.calendarGridLabel?'),calendarGridDays:Mac.CalendarGridDay.extend({})});require('core');Mac.SliderView=Mac.View.extend({isEnabled:true,isEnabledBindingDefault:SC.Binding.OneWayFlag,isSelected:false,isSelectedBindingDefault:SC.Binding.OneWayFlag,alignX:-7,alignY:0,axis:'horizontal',minimum:0,maximum:1,value:0.5,localize:true,outlets:['handleView','trackView','smallerView','largerView'],handleView:'.handle?',trackView:'.track?',toolTip:"_VisitorExperience.AlbumPage.HeaderFooter.Slider.Tooltip",smallerView:Mac.ButtonView.extend({localize:true,toolTip:"_VisitorExperience.AlbumPage.HeaderFooter.SliderSmallest.Tooltip",action:function(ev){this.owner._changingValue=false;this.owner.scaleIt(0);}}).outletFor('.smaller?'),largerView:Mac.ButtonView.extend({localize:true,toolTip:"_VisitorExperience.AlbumPage.HeaderFooter.SliderLargest.Tooltip",action:function(ev){this.owner._changingValue=false;this.owner.scaleIt(1);}}).outletFor('.larger?'),_slider:null,offsetValue:function(key,value){var min=this.get('minimum');var max=this.get('maximum');if(value!==undefined&&value!=null&&value>=0&&value<=1){this.value=min+(value*(max-min));}
return(this.value-min)/(max-min);}.property(),init:function()
{arguments.callee.base.call(this);this.registerDependentKey('offsetValue','value');this.registerDependentKey('value','offsetValue');this._oldValue=this.get('offsetValue');},configureSlider:function()
{var sliderValue=this.get("offsetValue");var func=this.scaleIt.bind(this);if(this._slider)this._slider.dispose();this._slider=new Control.Slider(this.handleView,this.trackView,{axis:this.get("axis"),alignX:this.get("alignX"),alignY:this.get('alignY'),range:$R(0,1),sliderValue:sliderValue,onSlide:func,onChange:func});this._updateSliderState();},scaleIt:function(value)
{if(this._changingValue)return;if(value!=this.get('offsetValue'))this.set('offsetValue',value);},_updateClassForState:function(){var enabled=this.get('isEnabled');var slider=this._slider;if(enabled){this.removeClassName('disabled');}else{this.addClassName('disabled');}
(this.get('isSelected'))?this.addClassName('sel'):this.removeClassName('sel');},_updateSliderState:function(){var enabled=this.get('isEnabled');var slider=this._slider;if(slider&&enabled){}else if(slider&&!enabled){slider.setDisabled();}else{}},propertyObserver:function(observing,target,key,newValue){var slider=this._slider;this._changingValue=true;if(key=='offsetValue'){if(slider){slider.setValue(newValue);}else if(newValue!=this._oldValue){this.configureSlider();}
this._oldValue=newValue;}
this._changingValue=false;if((target==this)&&(['isEnabled','isSelected'].include(key))){this._updateClassForState();this._updateSliderState();}}});require('view/flash');Mac.Uploader=Mac.FlashView.extend({useFlash10:true,loadParameters:{wmode:"transparent"},loadAttributes:{wmode:"transparent"},uploadDescription:'',allowedFileTypes:"",allowedFileSize:10000,retryCount:0,chooseFiles:function(){var movie=this.get('movie');if(movie)
{if(!movie.chooseFiles&&++this.retryCount<3)
setTimeout(function(){this.owner.chooseFiles();}.bind(this),500);else
{var wo=window.opener;if(wo&&wo.Gallery.albumController.get('viewIdentifier')===wo.VIEW_APERTURE_ALBUM)
this.set('allowedFileTypes',this.allowedFileTypesAperture);else
this.set('allowedFileTypes',this.allowedFileTypesiPhoto);movie.chooseFiles();}}},uploadFile:function(guid,url){var movie=this.get('movie');if(movie)movie.uploadFile(guid,url);},cancelFile:function(guid){var movie=this.get('movie');if(movie)movie.cancelUpload(guid);},flashInfo:function(){var flashInfo;var movie=this.get('movie');if(movie&&movie.getFlashInfo){flashInfo=movie.getFlashInfo();return flashInfo;}else return null;}.property(),didChooseFile:function(fileInfo){var del=this.delegate||this.owner;if(del&&del.uploaderDidChooseFile)del.uploaderDidChooseFile(this,fileInfo);},uploadDidCancel:function(fileInfo){var del=this.delegate||this.owner;if(del&&del.uploaderDidCancelUpload){del.uploaderDidCancelUpload(this,fileInfo);}},uploadDidComplete:function(fileInfo){var del=this.delegate||this.owner;if(del&&del.uploaderDidCompleteUpload){del.uploaderDidCompleteUpload(this,fileInfo);}},uploadProgress:function(fileInfo,bytesLoaded,bytesTotal){var del=this.delegate||this.owner;if(del&&del.uploaderUploadProgress){del.uploaderUploadProgress(this,fileInfo,bytesLoaded,bytesTotal);}},uploadError:function(code,fileInfo,errString){var del=this.delegate||this.owner;if(del&&del.uploaderUploadError){del.uploaderUploadError(this,code,fileInfo,errString);}},version:'8.0.0',resourceURL:'/g/flash/uploader.swf',width:'32px',height:'32px',emptyElement:'<div style="visibility: hidden;"></div>',flashProperties:$w('uploadDescription allowedFileTypes allowedFileSize uploadURL'),init:function(){if(SC.isIE())
{this.loadParameters={wmode:"opaque"};this.loadAttributes={wmode:"transparent"};}
arguments.callee.base.call(this);if(!this.parentNode)$tag('body').appendChild(this);}});SC.ButtonView=SC.ButtonView.extend({mouseDidMove:function(evt)
{if(this.id!='chooseButton'||!Uploader)return;var uploader=Uploader.queueController.uploader;if(!uploader||!uploader.get('useFlash10'))return;uploader.setStyle({'top':evt.clientY-16+'px','left':evt.clientX-16+'px'});}});